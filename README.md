# MMM-IntelliCenter

[MagicMirrorÂ²](https://github.com/MagicMirrorOrg/MagicMirror) module used to connect to a local Pentair IntelliCenter pool controller system.

## Installation

1. Navigate into your MagicMirror's `modules` folder and execute `git clone https://github.com/parnic/MMM-IntelliCenter.git`.
2. `cd MMM-IntelliCenter`
3. Execute `npm install --omit=dev` to install the node dependencies.
4. Add the module inside `config.js` placing it where you prefer.

## Config

| Option               | Type    | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Default   |
| -------------------- | ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- |
| `coldTemp`           | Integer | Show the temperature colored blue if it's at or below this level for pool/spa (requires option `colored`). This is in whatever scale your system is set to (Fahrenheit/Celsius).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `84`      |
| `colored`            | Boolean | Whether you'd like colored output or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `true`    |
| `columns`            | Integer | How many columns to use to display the data before starting a new row.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `3`       |
| `contentClass`       | String  | The CSS class used to display content values (beneath the header).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `"light"` |
| `controls`           | Array   | List of controls to show buttons for. Must also set `showControls` to `true`.<br><br>Each entry in this list is an object with a `type` string property and a `name` string to display.<br><br>Valid `type`s:<br>`"circuit"` - toggle a circuit on or off. Must also have an `id` object name property defining the circuit ID to set (see [node-intellicenter](https://github.com/parnic/node-intellicenter) documentation for object names). `name` is an optional string; if not specified, the name of the equipment in the IntelliCenter system will be used.<br>`"heatmode"` - enable or disable the heater for the pool or spa. Must also have a `body` name property that defines which body to toggle the heater for (`"pool"` is the pool, `"spa"` is the spa) and a `"name"` property that contains the label to show for the button.<br>`"heatpoint"` - set the heat temperature for the pool or spa. Must also have a `body` name property that defines which body to set the heat point for (`"pool"` is the pool, `"spa"` is the spa) and a `"name"` property that contains the label to show for the button. | `[]`      |
| `hotTemp`            | Integer | Show the temperature colored red if it's at or above this level for pool/spa (requires option `colored`). This is in whatever scale your system is set to (Fahrenheit/Celsius).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `90`      |
| `multicastInterface` | String  | The IPv4 address of a network interface to use for unit discovery. Chooses a system default if not specified.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |           |
| `serverAddress`      | String  | The IPv4 address of a IntelliCenter unit to connect to. If not set, the system will search for a unit to connect to. If set, `serverPort` must also be set (the default is usually fine).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |           |
| `serverPort`         | Integer | The port of a IntelliCenter unit to connect to (usually 6680). If not set, the system will search for a unit to connect to. If set, `serverAddress` must also be set.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `6680`    |
| `showControls`       | Boolean | Whether you'd like to show buttons for controlling pool equipment. Must also setup the `controls` array.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `false`   |
| `showFreezeMode`     | Boolean | Whether you'd like to show a banner when the pool is in freeze mode or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `true`    |
| `showOrp`            | Boolean | Whether you'd like to show ORP level or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `true`    |
| `showPH`             | Boolean | Whether you'd like to show pH level or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `true`    |
| `showPHTankLevel`    | Boolean | Whether you'd like to show how much pH balancer is in the tank or not. Only functions if `showPH` is also on.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `true`    |
| `pHTankLevelMax`     | Boolean | If `showPHTankLevel` is enabled, this is the maximum value that the system returns for a full tank. My system has this always set to 7, but maybe it differs based on what type of pH balancer you're using.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `7`       |
| `showPoolTemp`       | Boolean | Whether you'd like to show pool temperature or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `true`    |
| `showSaltLevel`      | Boolean | Whether you'd like to show salt level (in PPM) or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `true`    |
| `showSaturation`     | Boolean | Whether you'd like to show saturation/balance or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `true`    |
| `showSpaTemp`        | Boolean | Whether you'd like to show spa temperature or not.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `true`    |

Here is an example of an entry in config.js

```js
{
    module: 'MMM-IntelliCenter',
    header: 'Pool info',
    position: 'top_left',
    config: {
        showSpaTemp: false,
        columns: 2,
        contentClass: 'thin',
        showControls: true,
        controls: [
            {type: 'circuit', id: "C0008"},
            {type: 'circuit', id: "C0006", name: 'Pool'},
            {type: 'heatmode', body: "pool", name: 'Pool heater'},
            {type: 'heatpoint', body: "pool", name: 'Pool'},
            {type: 'heatmode', body: "spa", name: 'Spa heater'},
        ]
    }
},
```

## Screenshot

### With color

![Screenshot with color](./screenshot.png?raw=true "colored: true")

## Notes

Pull requests are very welcome! If you'd like to see any additional functionality, don't hesitate to let me know.

This module only works with IntelliCenter controllers on the local network via either a UDP mDNS broadcast on 224.0.0.251 or a direct connection if you've specified an address and port in the configuration.

The data is updated when the pool equipment sends an update (which typically happens 0-2 seconds after anything changes).

When toggling a circuit or changing heat mode, sometimes other circuits are affected. For example, some pools share the same pump for the pool and spa, so when the pool is toggled on the spa must be toggled off. Unfortunately the IntelliCenter system doesn't update its internal status at any predictable rate, so the data on the screen can be wrong immediately after toggling a circuit until the next update runs (usually within a second or two).

## Libraries

This uses a Node.JS library I created for interfacing with IntelliCenter controllers over the network: [node-intellicenter](https://github.com/parnic/node-intellicenter), so feel free to check that out for more information.
